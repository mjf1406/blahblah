import{Z as re,a4 as k,r,j as e,a5 as le,V as de,a6 as ce,a7 as oe,a9 as he}from"./react-vendor-BkjCJ2qm.js";import{a as T}from"./index-Dipspglv.js";import{D as H,a as pe,B as x,b as $,c as P,d as L,L as l,I as C}from"./canvas-DoKDF16Z.js";import{u as xe,C as me,a as ue,b as ge,A as je,c as ve,d as ye,e as fe,f as we,g as Me,h as Ne,i as Se,j as Ce,B as Q,k as De}from"./usePersistsedQuery-ptHWNzrQ.js";import{t as c}from"./vendor-BmIbm0HI.js";import{T as U,S as D,a as b,b as _,c as O,d as t}from"./select-C0T8w-w7.js";import"./convex-vendor-Cf6wy2s6.js";import"./ui-vendor-BA32w1ww.js";import"./auth-BAUFcaTu.js";function Ee(){const{data:z=[]}=xe(T.maps.list,"maps-list"),E=re(T.worlds.list)||[],Z=k(T.maps.create),J=k(T.maps.update),K=k(T.maps.remove),[X,A]=r.useState(!1),[Y,I]=r.useState(!1),[W,B]=r.useState(null),[m,u]=r.useState(""),[F,g]=r.useState(""),[j,v]=r.useState(""),[y,f]=r.useState("none"),[d,h]=r.useState({width:0,height:0}),[w,M]=r.useState("none"),[N,S]=r.useState([]),[G,V]=r.useState(new Set);r.useEffect(()=>{if(z.length>0&&N.length>0){const s=N.filter(i=>!z.some(a=>a.name===i.name&&a.description===i.description&&a.type===i.type));s.length!==N.length&&S(s)}},[z,N]);const R=r.useMemo(()=>[...z.filter(i=>!G.has(i._id)).map(i=>({...i,isOptimistic:!1})),...N].sort((i,a)=>a._creationTime-i._creationTime),[z,N,G]),q=()=>{u(""),g(""),v(""),f("none"),h({width:0,height:0}),M("none")},ee=async s=>{if(s.preventDefault(),!m.trim()){c.error("Map name is required");return}if(!j){c.error("Map type is required");return}const i={name:m.trim(),description:F.trim(),type:j,gridSize:y==="none"?void 0:y,dimensions:d.width>0&&d.height>0?d:void 0,worldId:w==="none"?void 0:w},a={_id:`temp-${Date.now()}`,name:i.name,description:i.description,type:i.type,gridSize:i.gridSize,dimensions:i.dimensions,worldId:i.worldId,_creationTime:Date.now(),isOptimistic:!0};S(p=>[a,...p]),q(),A(!1),c.success("Map created successfully!");try{await Z(i)}catch{S(p=>p.filter(n=>n._id!==a._id)),c.error("Failed to create map"),u(i.name),g(i.description),v(i.type),f(i.gridSize||"none"),h(i.dimensions||{width:0,height:0}),M(i.worldId||"none"),A(!0)}},se=async s=>{if(s.preventDefault(),!W)return;if(!m.trim()){c.error("Map name is required");return}if(!j){c.error("Map type is required");return}const i={name:m.trim(),description:F.trim(),type:j,gridSize:y==="none"?void 0:y,dimensions:d.width>0&&d.height>0?d:void 0,worldId:w==="none"?void 0:w},a=W,p={_id:`temp-edit-${W._id}-${Date.now()}`,name:i.name,description:i.description,type:i.type,gridSize:i.gridSize,dimensions:i.dimensions,worldId:i.worldId,_creationTime:W._creationTime,isOptimistic:!0};V(n=>new Set(n).add(a._id)),S(n=>[p,...n]),q(),B(null),I(!1),c.success("Map updated successfully!");try{await J({id:a._id,name:i.name,description:i.description,type:i.type,gridSize:i.gridSize,dimensions:i.dimensions,worldId:i.worldId}),S(n=>n.filter(o=>o._id!==p._id)),V(n=>{const o=new Set(n);return o.delete(a._id),o})}catch{S(n=>n.filter(o=>o._id!==p._id)),V(n=>{const o=new Set(n);return o.delete(a._id),o}),c.error("Failed to update map"),B(a),u(i.name),g(i.description),v(i.type),f(i.gridSize||"none"),h(i.dimensions||{width:0,height:0}),M(i.worldId||"none"),I(!0)}},ie=s=>{B(s),u(s.name),g(s.description),v(s.type),f(s.gridSize||"none"),h(s.dimensions||{width:0,height:0}),M(s.worldId||"none"),I(!0)},te=async s=>{try{await K({id:s}),c.success("Map deleted successfully!")}catch{c.error("Failed to delete map")}},ae=s=>{switch(s){case"Battle Map":return"bg-red-100 text-red-800";case"World Map":return"bg-blue-100 text-blue-800";case"Dungeon Map":return"bg-purple-100 text-purple-800";case"City Map":return"bg-green-100 text-green-800";case"Regional Map":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},ne=s=>{const i=E.find(a=>a._id===s);return(i==null?void 0:i.name)||"Unknown World"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Maps"}),e.jsxs(H,{open:X,onOpenChange:A,children:[e.jsx(pe,{asChild:!0,children:e.jsxs(x,{children:[e.jsx(le,{className:"w-4 h-4 mr-2"}),"Add Map"]})}),e.jsxs($,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(P,{children:e.jsx(L,{children:"Create New Map"})}),e.jsxs("form",{onSubmit:s=>void ee(s),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Map Name"}),e.jsx(C,{id:"name",value:m,onChange:s=>u(s.target.value),placeholder:"Enter map name"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"description",children:"Description"}),e.jsx(U,{id:"description",value:F,onChange:s=>g(s.target.value),placeholder:"Describe the map...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"type",children:"Map Type"}),e.jsxs(D,{value:j,onValueChange:v,children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Select type"})}),e.jsxs(O,{children:[e.jsx(t,{value:"Battle Map",children:"Battle Map"}),e.jsx(t,{value:"World Map",children:"World Map"}),e.jsx(t,{value:"Dungeon Map",children:"Dungeon Map"}),e.jsx(t,{value:"City Map",children:"City Map"}),e.jsx(t,{value:"Regional Map",children:"Regional Map"}),e.jsx(t,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"gridSize",children:"Grid Size (Optional)"}),e.jsxs(D,{value:y,onValueChange:f,children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Select grid size"})}),e.jsxs(O,{children:[e.jsx(t,{value:"none",children:"No Grid"}),e.jsx(t,{value:"5ft",children:"5 feet"}),e.jsx(t,{value:"10ft",children:"10 feet"}),e.jsx(t,{value:"1 mile",children:"1 mile"}),e.jsx(t,{value:"10 miles",children:"10 miles"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Dimensions (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsx(C,{type:"number",placeholder:"Width",value:d.width||"",onChange:s=>h(i=>({...i,width:parseInt(s.target.value)||0}))}),e.jsx(C,{type:"number",placeholder:"Height",value:d.height||"",onChange:s=>h(i=>({...i,height:parseInt(s.target.value)||0}))})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"world",children:"Associated World (Optional)"}),e.jsxs(D,{value:w,onValueChange:M,children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Select world"})}),e.jsxs(O,{children:[e.jsx(t,{value:"none",children:"No World"}),E.map(s=>e.jsx(t,{value:s._id,children:s.name},s._id))]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>A(!1),className:"flex-1",children:"Cancel"}),e.jsx(x,{type:"submit",className:"flex-1",children:"Create Map"})]})]})]})]}),e.jsx(H,{open:Y,onOpenChange:I,children:e.jsxs($,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(P,{children:e.jsx(L,{children:"Edit Map"})}),e.jsxs("form",{onSubmit:s=>void se(s),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"editName",children:"Map Name"}),e.jsx(C,{id:"editName",value:m,onChange:s=>u(s.target.value),placeholder:"Enter map name"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"editDescription",children:"Description"}),e.jsx(U,{id:"editDescription",value:F,onChange:s=>g(s.target.value),placeholder:"Describe the map...",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"editType",children:"Map Type"}),e.jsxs(D,{value:j,onValueChange:v,children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Select type"})}),e.jsxs(O,{children:[e.jsx(t,{value:"Battle Map",children:"Battle Map"}),e.jsx(t,{value:"World Map",children:"World Map"}),e.jsx(t,{value:"Dungeon Map",children:"Dungeon Map"}),e.jsx(t,{value:"City Map",children:"City Map"}),e.jsx(t,{value:"Regional Map",children:"Regional Map"}),e.jsx(t,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"editGridSize",children:"Grid Size (Optional)"}),e.jsxs(D,{value:y,onValueChange:f,children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Select grid size"})}),e.jsxs(O,{children:[e.jsx(t,{value:"none",children:"No Grid"}),e.jsx(t,{value:"5ft",children:"5 feet"}),e.jsx(t,{value:"10ft",children:"10 feet"}),e.jsx(t,{value:"1 mile",children:"1 mile"}),e.jsx(t,{value:"10 miles",children:"10 miles"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Dimensions (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-1",children:[e.jsx(C,{type:"number",placeholder:"Width",value:d.width||"",onChange:s=>h(i=>({...i,width:parseInt(s.target.value)||0}))}),e.jsx(C,{type:"number",placeholder:"Height",value:d.height||"",onChange:s=>h(i=>({...i,height:parseInt(s.target.value)||0}))})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"editWorld",children:"Associated World (Optional)"}),e.jsxs(D,{value:w,onValueChange:M,children:[e.jsx(b,{children:e.jsx(_,{placeholder:"Select world"})}),e.jsxs(O,{children:[e.jsx(t,{value:"none",children:"No World"}),E.map(s=>e.jsx(t,{value:s._id,children:s.name},s._id))]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>I(!1),className:"flex-1",children:"Cancel"}),e.jsx(x,{type:"submit",className:"flex-1",children:"Update Map"})]})]})]})})]}),R.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(de,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg text-gray-500",children:"No maps created yet"}),e.jsx("p",{className:"text-gray-400",children:'Click "Add Map" to get started'})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:R.map(s=>e.jsxs(me,{className:`hover:shadow-md transition-shadow ${s.isOptimistic?"opacity-70 animate-pulse":""}`,children:[e.jsxs(ue,{className:"relative",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs(ge,{className:"flex items-center gap-2 pr-8 text-lg",children:[s.name,s.isOptimistic&&e.jsx("span",{className:"px-2 py-1 text-xs rounded text-muted-foreground bg-muted",children:"Saving..."})]}),!s.isOptimistic&&e.jsxs("div",{className:"absolute flex gap-1 top-4 right-4",children:[e.jsx(x,{variant:"ghost",size:"sm",onClick:()=>ie(s),className:"w-8 h-8 p-0 hover:bg-gray-100",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsxs(je,{children:[e.jsx(ve,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 hover:bg-red-100 hover:text-red-600",children:e.jsx(oe,{className:"w-4 h-4"})})}),e.jsxs(ye,{children:[e.jsxs(fe,{children:[e.jsx(we,{children:"Delete Map"}),e.jsxs(Me,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone.']})]}),e.jsxs(Ne,{children:[e.jsx(Se,{children:"Cancel"}),e.jsx(Ce,{onClick:()=>void te(s._id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Q,{className:ae(s.type),children:s.type}),s.gridSize&&e.jsxs(Q,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(he,{className:"w-3 h-3"}),s.gridSize]})]})]}),e.jsx(De,{children:e.jsxs("div",{className:"space-y-3",children:[s.description&&e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("div",{className:"space-y-2",children:[s.dimensions&&e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"Dimensions:"})," ",s.dimensions.width," ×"," ",s.dimensions.height]}),s.worldId&&e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"font-medium",children:"World:"})," ",ne(s.worldId)]})]})]})})]},s._id))})]})}export{Ee as MapManager};
