import{a4 as P,r,j as e,a5 as V,a7 as H,Q as ne,a6 as re,a8 as ce}from"./react-vendor-BkjCJ2qm.js";import{a as L}from"./index-Dipspglv.js";import{D as Q,a as oe,B as c,b as G,c as R,d as U,L as m,I as _}from"./canvas-DoKDF16Z.js";import{u as de,C as he,a as me,b as xe,A as ue,c as pe,d as je,e as ge,f as ve,g as ye,h as fe,i as Ne,j as be,B as J,k as we}from"./usePersistsedQuery-ptHWNzrQ.js";import{t as o}from"./vendor-BmIbm0HI.js";import{T as A,S as F,a as T,b as O,c as k,d as i}from"./select-C0T8w-w7.js";import"./convex-vendor-Cf6wy2s6.js";import"./ui-vendor-BA32w1ww.js";import"./auth-BAUFcaTu.js";function Oe(){const{data:w=[]}=de(L.worlds.list,"worlds-list"),K=P(L.worlds.create),X=P(L.worlds.update),Y=P(L.worlds.remove),[Z,S]=r.useState(!1),[ee,C]=r.useState(!1),[D,E]=r.useState(null),[p,j]=r.useState(""),[W,g]=r.useState(""),[v,y]=r.useState(""),[x,u]=r.useState([]),[f,N]=r.useState([]),[z,M]=r.useState(new Set);r.useEffect(()=>{if(w.length>0&&f.length>0){const s=f.filter(a=>!w.some(t=>t.name===a.name&&t.description===a.description&&t.setting===a.setting));s.length!==f.length&&N(s)}},[w,f]);const q=r.useMemo(()=>[...w.filter(a=>!z.has(a._id)).map(a=>({...a,isOptimistic:!1})),...f].sort((a,t)=>t._creationTime-a._creationTime),[w,f,z]),B=()=>{j(""),g(""),y(""),u([])},$=()=>{u([...x,{name:"",type:"",description:""}])},I=s=>{u(x.filter((a,t)=>t!==s))},b=(s,a,t)=>{const n=[...x];n[s]={...n[s],[a]:t},u(n)},se=async s=>{if(s.preventDefault(),!p.trim()){o.error("World name is required");return}if(!v){o.error("Setting is required");return}const a=x.filter(d=>d.name.trim()),t={name:p.trim(),description:W.trim(),setting:v,locations:a},n={_id:`temp-${Date.now()}`,name:t.name,description:t.description,setting:t.setting,locations:t.locations,_creationTime:Date.now(),isOptimistic:!0};N(d=>[n,...d]),B(),S(!1),o.success("World created successfully!");try{await K(t)}catch{N(d=>d.filter(l=>l._id!==n._id)),o.error("Failed to create world"),j(t.name),g(t.description),y(t.setting),u(t.locations),S(!0)}},te=async s=>{if(s.preventDefault(),!D)return;if(!p.trim()){o.error("World name is required");return}if(!v){o.error("Setting is required");return}const a=x.filter(l=>l.name.trim()),t={name:p.trim(),description:W.trim(),setting:v,locations:a},n=D,d={_id:`temp-edit-${D._id}-${Date.now()}`,name:t.name,description:t.description,setting:t.setting,locations:t.locations,_creationTime:D._creationTime,isOptimistic:!0};M(l=>new Set(l).add(n._id)),N(l=>[d,...l]),B(),E(null),C(!1),o.success("World updated successfully!");try{await X({id:n._id,name:t.name,description:t.description,setting:t.setting,locations:t.locations}),N(l=>l.filter(h=>h._id!==d._id)),M(l=>{const h=new Set(l);return h.delete(n._id),h})}catch{N(l=>l.filter(h=>h._id!==d._id)),M(l=>{const h=new Set(l);return h.delete(n._id),h}),o.error("Failed to update world"),E(n),j(t.name),g(t.description),y(t.setting),u(t.locations),C(!0)}},ae=s=>{E(s),j(s.name),g(s.description),y(s.setting),u(s.locations),C(!0)},ie=async s=>{try{await Y({id:s}),o.success("World deleted successfully!")}catch{o.error("Failed to delete world")}},le=s=>{switch(s){case"Fantasy":return"bg-purple-100 text-purple-800";case"Sci-Fi":return"bg-blue-100 text-blue-800";case"Modern":return"bg-green-100 text-green-800";case"Historical":return"bg-yellow-100 text-yellow-800";case"Post-Apocalyptic":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Worlds"}),e.jsxs(Q,{open:Z,onOpenChange:S,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(c,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Add World"]})}),e.jsxs(G,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(R,{children:e.jsx(U,{children:"Create New World"})}),e.jsxs("form",{onSubmit:s=>void se(s),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"name",children:"World Name"}),e.jsx(_,{id:"name",value:p,onChange:s=>j(s.target.value),placeholder:"Enter world name"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(A,{id:"description",value:W,onChange:s=>g(s.target.value),placeholder:"Describe the world...",rows:3})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"setting",children:"Setting"}),e.jsxs(F,{value:v,onValueChange:y,children:[e.jsx(T,{children:e.jsx(O,{placeholder:"Select setting"})}),e.jsxs(k,{children:[e.jsx(i,{value:"Fantasy",children:"Fantasy"}),e.jsx(i,{value:"Sci-Fi",children:"Sci-Fi"}),e.jsx(i,{value:"Modern",children:"Modern"}),e.jsx(i,{value:"Historical",children:"Historical"}),e.jsx(i,{value:"Post-Apocalyptic",children:"Post-Apocalyptic"}),e.jsx(i,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m,{children:"Locations"}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:$,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Add Location"]})]}),e.jsx("div",{className:"space-y-2 overflow-y-auto max-h-48",children:x.map((s,a)=>e.jsxs("div",{className:"p-3 space-y-2 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{placeholder:"Location name",value:s.name,onChange:t=>b(a,"name",t.target.value),className:"flex-1"}),e.jsxs(F,{value:s.type,onValueChange:t=>b(a,"type",t),children:[e.jsx(T,{className:"w-32",children:e.jsx(O,{placeholder:"Type"})}),e.jsxs(k,{children:[e.jsx(i,{value:"City",children:"City"}),e.jsx(i,{value:"Town",children:"Town"}),e.jsx(i,{value:"Village",children:"Village"}),e.jsx(i,{value:"Dungeon",children:"Dungeon"}),e.jsx(i,{value:"Wilderness",children:"Wilderness"}),e.jsx(i,{value:"Landmark",children:"Landmark"})]})]}),e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:()=>I(a),children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsx(A,{placeholder:"Location description",value:s.description,onChange:t=>b(a,"description",t.target.value),rows:2})]},a))})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>S(!1),className:"flex-1",children:"Cancel"}),e.jsx(c,{type:"submit",className:"flex-1",children:"Create World"})]})]})]})]}),e.jsx(Q,{open:ee,onOpenChange:C,children:e.jsxs(G,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(R,{children:e.jsx(U,{children:"Edit World"})}),e.jsxs("form",{onSubmit:s=>void te(s),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"editName",children:"World Name"}),e.jsx(_,{id:"editName",value:p,onChange:s=>j(s.target.value),placeholder:"Enter world name"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"editDescription",children:"Description"}),e.jsx(A,{id:"editDescription",value:W,onChange:s=>g(s.target.value),placeholder:"Describe the world...",rows:3})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"editSetting",children:"Setting"}),e.jsxs(F,{value:v,onValueChange:y,children:[e.jsx(T,{children:e.jsx(O,{placeholder:"Select setting"})}),e.jsxs(k,{children:[e.jsx(i,{value:"Fantasy",children:"Fantasy"}),e.jsx(i,{value:"Sci-Fi",children:"Sci-Fi"}),e.jsx(i,{value:"Modern",children:"Modern"}),e.jsx(i,{value:"Historical",children:"Historical"}),e.jsx(i,{value:"Post-Apocalyptic",children:"Post-Apocalyptic"}),e.jsx(i,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m,{children:"Locations"}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:$,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Add Location"]})]}),e.jsx("div",{className:"space-y-2 overflow-y-auto max-h-48",children:x.map((s,a)=>e.jsxs("div",{className:"p-3 space-y-2 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{placeholder:"Location name",value:s.name,onChange:t=>b(a,"name",t.target.value),className:"flex-1"}),e.jsxs(F,{value:s.type,onValueChange:t=>b(a,"type",t),children:[e.jsx(T,{className:"w-32",children:e.jsx(O,{placeholder:"Type"})}),e.jsxs(k,{children:[e.jsx(i,{value:"City",children:"City"}),e.jsx(i,{value:"Town",children:"Town"}),e.jsx(i,{value:"Village",children:"Village"}),e.jsx(i,{value:"Dungeon",children:"Dungeon"}),e.jsx(i,{value:"Wilderness",children:"Wilderness"}),e.jsx(i,{value:"Landmark",children:"Landmark"})]})]}),e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:()=>I(a),children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsx(A,{placeholder:"Location description",value:s.description,onChange:t=>b(a,"description",t.target.value),rows:2})]},a))})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>C(!1),className:"flex-1",children:"Cancel"}),e.jsx(c,{type:"submit",className:"flex-1",children:"Update World"})]})]})]})})]}),q.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(ne,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg text-gray-500",children:"No worlds created yet"}),e.jsx("p",{className:"text-gray-400",children:'Click "Add World" to get started'})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:q.map(s=>e.jsxs(he,{className:`hover:shadow-md transition-shadow ${s.isOptimistic?"opacity-70 animate-pulse":""}`,children:[e.jsxs(me,{className:"relative",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs(xe,{className:"flex items-center gap-2 pr-8 text-lg",children:[s.name,s.isOptimistic&&e.jsx("span",{className:"px-2 py-1 text-xs rounded text-muted-foreground bg-muted",children:"Saving..."})]}),!s.isOptimistic&&e.jsxs("div",{className:"absolute flex gap-1 top-4 right-4",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>ae(s),className:"w-8 h-8 p-0 hover:bg-gray-100",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsxs(ue,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 hover:bg-red-100 hover:text-red-600",children:e.jsx(H,{className:"w-4 h-4"})})}),e.jsxs(je,{children:[e.jsxs(ge,{children:[e.jsx(ve,{children:"Delete World"}),e.jsxs(ye,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone.']})]}),e.jsxs(fe,{children:[e.jsx(Ne,{children:"Cancel"}),e.jsx(be,{onClick:()=>void ie(s._id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),e.jsx(J,{className:le(s.setting),children:s.setting})]}),e.jsx(we,{children:e.jsxs("div",{className:"space-y-3",children:[s.description&&e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),s.locations.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"flex items-center gap-1 mb-2 text-sm font-medium text-gray-600",children:[e.jsx(ce,{className:"w-3 h-3"}),"Locations (",s.locations.length,")"]}),e.jsxs("div",{className:"space-y-1 overflow-y-auto max-h-32",children:[s.locations.slice(0,3).map((a,t)=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:a.name}),e.jsx(J,{variant:"outline",className:"px-1 py-0 text-xs",children:a.type})]},t)),s.locations.length>3&&e.jsxs("p",{className:"text-xs text-gray-400",children:["+",s.locations.length-3," ","more..."]})]})]})]})})]},s._id))})]})}export{Oe as WorldManager};
