import{c as le,a as _,u as P,r,j as e,B as c,G as re,t as o}from"./index-BemgFq4H.js";import{D as G,a as ce,b as Q,c as R,d as U,L as m,I as L}from"./label-DZ_TKCWk.js";import{u as oe,P as V,T as H,C as de,a as he,b as me,S as xe,A as ue,c as pe,d as je,e as ge,f as ve,g as ye,h as fe,i as Ne,j as be,B as J,k as we}from"./usePersistsedQuery-BZ7BbAR6.js";import{T,S as A,a as F,b as O,c as k,d as i}from"./select-CcPzhzHt.js";import"./index-D-NtcquE.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Se=le("map-pin",Ce);function Ae(){const{data:w=[]}=oe(_.worlds.list,"worlds-list"),K=P(_.worlds.create),X=P(_.worlds.update),Y=P(_.worlds.remove),[Z,S]=r.useState(!1),[ee,C]=r.useState(!1),[D,E]=r.useState(null),[p,j]=r.useState(""),[W,g]=r.useState(""),[v,y]=r.useState(""),[x,u]=r.useState([]),[f,N]=r.useState([]),[z,M]=r.useState(new Set);r.useEffect(()=>{if(w.length>0&&f.length>0){const s=f.filter(a=>!w.some(t=>t.name===a.name&&t.description===a.description&&t.setting===a.setting));s.length!==f.length&&N(s)}},[w,f]);const q=r.useMemo(()=>[...w.filter(a=>!z.has(a._id)).map(a=>({...a,isOptimistic:!1})),...f].sort((a,t)=>t._creationTime-a._creationTime),[w,f,z]),B=()=>{j(""),g(""),y(""),u([])},I=()=>{u([...x,{name:"",type:"",description:""}])},$=s=>{u(x.filter((a,t)=>t!==s))},b=(s,a,t)=>{const l=[...x];l[s]={...l[s],[a]:t},u(l)},se=async s=>{if(s.preventDefault(),!p.trim()){o.error("World name is required");return}if(!v){o.error("Setting is required");return}const a=x.filter(d=>d.name.trim()),t={name:p.trim(),description:W.trim(),setting:v,locations:a},l={_id:`temp-${Date.now()}`,name:t.name,description:t.description,setting:t.setting,locations:t.locations,_creationTime:Date.now(),isOptimistic:!0};N(d=>[l,...d]),B(),S(!1),o.success("World created successfully!");try{await K(t)}catch{N(d=>d.filter(n=>n._id!==l._id)),o.error("Failed to create world"),j(t.name),g(t.description),y(t.setting),u(t.locations),S(!0)}},te=async s=>{if(s.preventDefault(),!D)return;if(!p.trim()){o.error("World name is required");return}if(!v){o.error("Setting is required");return}const a=x.filter(n=>n.name.trim()),t={name:p.trim(),description:W.trim(),setting:v,locations:a},l=D,d={_id:`temp-edit-${D._id}-${Date.now()}`,name:t.name,description:t.description,setting:t.setting,locations:t.locations,_creationTime:D._creationTime,isOptimistic:!0};M(n=>new Set(n).add(l._id)),N(n=>[d,...n]),B(),E(null),C(!1),o.success("World updated successfully!");try{await X({id:l._id,name:t.name,description:t.description,setting:t.setting,locations:t.locations}),N(n=>n.filter(h=>h._id!==d._id)),M(n=>{const h=new Set(n);return h.delete(l._id),h})}catch{N(n=>n.filter(h=>h._id!==d._id)),M(n=>{const h=new Set(n);return h.delete(l._id),h}),o.error("Failed to update world"),E(l),j(t.name),g(t.description),y(t.setting),u(t.locations),C(!0)}},ae=s=>{E(s),j(s.name),g(s.description),y(s.setting),u(s.locations),C(!0)},ie=async s=>{try{await Y({id:s}),o.success("World deleted successfully!")}catch{o.error("Failed to delete world")}},ne=s=>{switch(s){case"Fantasy":return"bg-purple-100 text-purple-800";case"Sci-Fi":return"bg-blue-100 text-blue-800";case"Modern":return"bg-green-100 text-green-800";case"Historical":return"bg-yellow-100 text-yellow-800";case"Post-Apocalyptic":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Worlds"}),e.jsxs(G,{open:Z,onOpenChange:S,children:[e.jsx(ce,{asChild:!0,children:e.jsxs(c,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Add World"]})}),e.jsxs(Q,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(R,{children:e.jsx(U,{children:"Create New World"})}),e.jsxs("form",{onSubmit:s=>void se(s),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"name",children:"World Name"}),e.jsx(L,{id:"name",value:p,onChange:s=>j(s.target.value),placeholder:"Enter world name"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"description",children:"Description"}),e.jsx(T,{id:"description",value:W,onChange:s=>g(s.target.value),placeholder:"Describe the world...",rows:3})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"setting",children:"Setting"}),e.jsxs(A,{value:v,onValueChange:y,children:[e.jsx(F,{children:e.jsx(O,{placeholder:"Select setting"})}),e.jsxs(k,{children:[e.jsx(i,{value:"Fantasy",children:"Fantasy"}),e.jsx(i,{value:"Sci-Fi",children:"Sci-Fi"}),e.jsx(i,{value:"Modern",children:"Modern"}),e.jsx(i,{value:"Historical",children:"Historical"}),e.jsx(i,{value:"Post-Apocalyptic",children:"Post-Apocalyptic"}),e.jsx(i,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m,{children:"Locations"}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:I,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Add Location"]})]}),e.jsx("div",{className:"space-y-2 overflow-y-auto max-h-48",children:x.map((s,a)=>e.jsxs("div",{className:"p-3 space-y-2 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{placeholder:"Location name",value:s.name,onChange:t=>b(a,"name",t.target.value),className:"flex-1"}),e.jsxs(A,{value:s.type,onValueChange:t=>b(a,"type",t),children:[e.jsx(F,{className:"w-32",children:e.jsx(O,{placeholder:"Type"})}),e.jsxs(k,{children:[e.jsx(i,{value:"City",children:"City"}),e.jsx(i,{value:"Town",children:"Town"}),e.jsx(i,{value:"Village",children:"Village"}),e.jsx(i,{value:"Dungeon",children:"Dungeon"}),e.jsx(i,{value:"Wilderness",children:"Wilderness"}),e.jsx(i,{value:"Landmark",children:"Landmark"})]})]}),e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:()=>$(a),children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsx(T,{placeholder:"Location description",value:s.description,onChange:t=>b(a,"description",t.target.value),rows:2})]},a))})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>S(!1),className:"flex-1",children:"Cancel"}),e.jsx(c,{type:"submit",className:"flex-1",children:"Create World"})]})]})]})]}),e.jsx(G,{open:ee,onOpenChange:C,children:e.jsxs(Q,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(R,{children:e.jsx(U,{children:"Edit World"})}),e.jsxs("form",{onSubmit:s=>void te(s),className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"editName",children:"World Name"}),e.jsx(L,{id:"editName",value:p,onChange:s=>j(s.target.value),placeholder:"Enter world name"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"editDescription",children:"Description"}),e.jsx(T,{id:"editDescription",value:W,onChange:s=>g(s.target.value),placeholder:"Describe the world...",rows:3})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"editSetting",children:"Setting"}),e.jsxs(A,{value:v,onValueChange:y,children:[e.jsx(F,{children:e.jsx(O,{placeholder:"Select setting"})}),e.jsxs(k,{children:[e.jsx(i,{value:"Fantasy",children:"Fantasy"}),e.jsx(i,{value:"Sci-Fi",children:"Sci-Fi"}),e.jsx(i,{value:"Modern",children:"Modern"}),e.jsx(i,{value:"Historical",children:"Historical"}),e.jsx(i,{value:"Post-Apocalyptic",children:"Post-Apocalyptic"}),e.jsx(i,{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(m,{children:"Locations"}),e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:I,children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Add Location"]})]}),e.jsx("div",{className:"space-y-2 overflow-y-auto max-h-48",children:x.map((s,a)=>e.jsxs("div",{className:"p-3 space-y-2 border rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{placeholder:"Location name",value:s.name,onChange:t=>b(a,"name",t.target.value),className:"flex-1"}),e.jsxs(A,{value:s.type,onValueChange:t=>b(a,"type",t),children:[e.jsx(F,{className:"w-32",children:e.jsx(O,{placeholder:"Type"})}),e.jsxs(k,{children:[e.jsx(i,{value:"City",children:"City"}),e.jsx(i,{value:"Town",children:"Town"}),e.jsx(i,{value:"Village",children:"Village"}),e.jsx(i,{value:"Dungeon",children:"Dungeon"}),e.jsx(i,{value:"Wilderness",children:"Wilderness"}),e.jsx(i,{value:"Landmark",children:"Landmark"})]})]}),e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:()=>$(a),children:e.jsx(H,{className:"w-4 h-4"})})]}),e.jsx(T,{placeholder:"Location description",value:s.description,onChange:t=>b(a,"description",t.target.value),rows:2})]},a))})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>C(!1),className:"flex-1",children:"Cancel"}),e.jsx(c,{type:"submit",className:"flex-1",children:"Update World"})]})]})]})})]}),q.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(re,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-lg text-gray-500",children:"No worlds created yet"}),e.jsx("p",{className:"text-gray-400",children:'Click "Add World" to get started'})]}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:q.map(s=>e.jsxs(de,{className:`hover:shadow-md transition-shadow ${s.isOptimistic?"opacity-70 animate-pulse":""}`,children:[e.jsxs(he,{className:"relative",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs(me,{className:"flex items-center gap-2 pr-8 text-lg",children:[s.name,s.isOptimistic&&e.jsx("span",{className:"px-2 py-1 text-xs rounded text-muted-foreground bg-muted",children:"Saving..."})]}),!s.isOptimistic&&e.jsxs("div",{className:"absolute flex gap-1 top-4 right-4",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>ae(s),className:"w-8 h-8 p-0 hover:bg-gray-100",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsxs(ue,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(c,{variant:"ghost",size:"sm",className:"w-8 h-8 p-0 hover:bg-red-100 hover:text-red-600",children:e.jsx(H,{className:"w-4 h-4"})})}),e.jsxs(je,{children:[e.jsxs(ge,{children:[e.jsx(ve,{children:"Delete World"}),e.jsxs(ye,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone.']})]}),e.jsxs(fe,{children:[e.jsx(Ne,{children:"Cancel"}),e.jsx(be,{onClick:()=>void ie(s._id),className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})]})]})]}),e.jsx(J,{className:ne(s.setting),children:s.setting})]}),e.jsx(we,{children:e.jsxs("div",{className:"space-y-3",children:[s.description&&e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),s.locations.length>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"flex items-center gap-1 mb-2 text-sm font-medium text-gray-600",children:[e.jsx(Se,{className:"w-3 h-3"}),"Locations (",s.locations.length,")"]}),e.jsxs("div",{className:"space-y-1 overflow-y-auto max-h-32",children:[s.locations.slice(0,3).map((a,t)=>e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{children:a.name}),e.jsx(J,{variant:"outline",className:"px-1 py-0 text-xs",children:a.type})]},t)),s.locations.length>3&&e.jsxs("p",{className:"text-xs text-gray-400",children:["+",s.locations.length-3," ","more..."]})]})]})]})})]},s._id))})]})}export{Ae as WorldManager};
